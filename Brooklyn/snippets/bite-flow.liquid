<!-- /snippets/bite-flow.liquid -->
<style>
  .block {
    background: {{section.settings.color}};
  }
{% for block in section.blocks %}
  #block-{{block.id}} {
    grid-column-end: span {{block.settings.flow-item-colspan}};
    grid-row-end: span {{block.settings.flow-item-rowspan}};
    align-self: {{block.settings.flow-item-align}};
  }
{% endfor %}
</style>

<div class="bite-flow--container">

  {% for block in section.blocks %}

    {% if block.settings.product != blank %}
      {% assign product = all_products[block.settings.product] %}
      {% assign url = product.url %}
      {% assign image = product.featured_image %}
      {% assign type = 'product' %}

    {% else %}
      {% assign url = block.settings.link %}
      {% assign image = block.settings.image %}
      {% if image != blank %}
        {% assign type = 'image' %}
      {% else %}
        {% assign type = 'text' %}
      {% endif %}
    {% endif %}

    <div id="block-{{block.id}}" class="block {{ type }}" {{ block.shopify_attributes }}>

    {% if url != blank %}
      <a href="{{ url }}">
    {% endif %}

    {% if image != blank %}
        <img src="{{ image | img_url: 'master' }}">
    {% endif %}

    {% if block.settings.product != blank %}
        <div class="product-caption">
          <div class="product-title">{{ product.title }}</div>
          <div class="product-price">{{ product.price | money }}</div>
        </div>
    {% else if %}
        <div class="text">
          <h2>{{ block.settings.title }}</h2>
          <span {% if block.settings.no_uppercase == true %}style="text-transform: none;"{% endif %}>{{ block.settings.text | newline_to_br}}</span>
        </div>
    {% endif %}

    {% if url != blank %}
      </a>
    {% endif %}

  </div>
  {% endfor %}
</div>
